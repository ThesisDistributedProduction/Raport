
\section{\ref{PS:Q:Performance}}

\textit{Can we create a solution that scales such that the number of turbines does not impact the regulation cycle time?}

\subsection{Experimenit}
\label{sec:Exper:perfom}

%Scalability is by Bondi\cite{Bondi:2000:CSI:350391.350432} defined as \textit{the systems ability to accommodate an increasing number of elements or objects, to process growing volumes of work gracefully, and/or to be susceptible to enlargement}.

The \ref{PS:Q:Performance} question asks if the proposed decentralized solution is able to keep a constant regulation cycle time independent from the number of turbines. This problem operates in a 3-dimensional space with cycle time (ms), number of cache reads and number of turbines as parameters. To study the correlation between the parameters, we isolate two parameters by making the third constant.

Thus to fully address \ref{PS:Q:Performance} this experiment has been divided into two experiments:
 
\begin{description}
	\item[Experiment 1] aims to investigate the anti-correlation between the implemented sleep time of the regulation cycle and the number of cache reads for the decentralized system. This is relevant because changing the sleep time is expected to impact the number of cache reads, since an increase in sleep time increases the time Connext has to overwrite received states, thus decreasing the number of cache reads (as explained in \cref{sec:cachereads}: Cache reads). Thus the constant for this is experiment is the number of turbines.
	\item[Experiment 2] aims to investigate the impact on the regulation cycle time and the number of cache reads when increasing the number of turbines in the decentralized solution, and thus answer the \ref{PS:Q:Performance} problem. The constant for this experiment is the sleep time.
\end{description}


\subsection{Experiment 1: How sleep time impacts the regulation cycle time and the number of cache reads}
\label{subsec:Exper:perfom:1}
The purpose of this experiment is to show how the sleep time affects the number of cache reads and the regulation cycle time for the decentralized solution (see \cref{sec:cachereads} for cache reads description).  
The experiment is performed with cycle time t=\testCycletimeNumbers.  

The following procedure is used each time the experiment is performed:
\begin{enumerate}
	\item Start the system with a cycle time of t ms and 21 turbines.
	\item Make sure the system is stable.
	\item Start logging the regulation cycle time and the number of cache reads.
	\item Stop logging when 1000 data points are reached.
\end{enumerate}

\subsection{Experiment 2: How the number of turbines impacts the regulation cycle time and the number of cache reads}
\label{subsec:Exper:perfom:2}
The purpose of this experiment is to answer the \ref{PS:Q:Performance} problem, by showing how the number of turbines affects the regulation cycle time for the decentralized solution. To complete the picture we also investigate how the number of turbines affects the cache reads, since an expected side effect of increasing the number of turbines also increases the number of cache reads as described in \cref{sec:cachereads}.

The experiments are performed with n=\testTurbineNumbers ~turbines. The sleep time is set to 20 ms and is constant for this experiment.

The test system is expected to be running only one instance in a real life implementation, therefore the machine logging the data will only run one instance and the supporting machines will run the rest generating system load.

The following procedure is used each time the experiment is performed:
\begin{enumerate}
	\item Start the system with N turbines.
	\item Make sure the system is stable.
	\item Start logging the reported regulation run time and the number of cache reads.
	\item Stop logging when 1000 data points are reached.
\end{enumerate}


\subsection{Results}

\label{sec:exp:performance}
The cycle regulation time is defined as the difference between the receive timestamp of the oldest turbine state(tOldestState) received and the timestamp sampled right after, a new turbine state has been sent (tSent) (as illustrated on \cref{fig:timingDecentral}):

$$regulation~cycle~time=tSent-tOldestState$$

\begin{figure}[b]
	\input{figures/tikz/timingDiagramDecntral}
	\caption{Decentralized regulation time}
	\label{fig:timingDecentral}
\end{figure}

The timestamp of the oldest turbine state is used to include network traffic in the regulation cycle time, as opposed to just sampling the time locally.

We use the following box plot type (for \cref{fig:exp:decen:sleep} and \cref{fig:exp:decen:turbines}): The central mark is the median, the edges of the box are the 25th and 75th percentiles, the whiskers extend to the most extreme data points not considered outliers, and outliers are plotted individually. The whisker length is denoted as 1.5 IQR. 

\subsubsection{\nameref{subsec:Exper:perfom:1}}

\begin{figure}[h!]
	\centering
%	\input{figures/tikz/results/Test6_decentral_cycle_msleep}
	\input{results/matlab/Test6_nCycleTime}
	\caption{Decentralized solution with variable wait time cycle time experiment}
	\label{fig:exp:decen:sleep}
\end{figure}

\Cref{fig:exp:decen:sleep} show that the regulation cycle time and sleep time are linearly dependent. Outliers are focused around the boxes with the exception of the 10 ms data point. The 10 ms data point has box edges further apart from each other than other data points. This is caused by having too many turbine instances running on the same PC's, thus stressing the experiment equipment (see \cref{sec:hardwareSepc} for hardware specification) too much, which causes package delays. Hence the 10 ms data point cannot be completely trusted.

\begin{figure}[h!]
	\centering
	\input{figures/tikz/results/Test6_decentral_cycle_msleep_cache}
	\caption{Decentralized solution with variable wait time cache reads experiment}
	\label{fig:exp:decen:sleep-cache}
\end{figure}

\FloatBarrier

\Cref{fig:exp:decen:sleep-cache} show that the average cache reads is declining when increasing the sleep time. As described in \cref{sec:cachereads}, cache reads only indicates if a given state has been read before, thus the number does not increase with the number times the same state has been read. Again, the 10 ms data point cannot be completely trusted due to limited experiment equipment.
%, a fitted function of the plot has been put on top (red), the plot is in Matlab fitted against the function $\dfrac{a}{x + b} + c$.

\clearpage
\subsubsection{\nameref{subsec:Exper:perfom:2}}

\begin{figure}[h!]
	\centering
%	\input{figures/tikz/results/Test5_decentral_cycle}
	\input{results/matlab/Test5_nTurbines}
	
	\caption{Decentralized solution variable number of turbines experiment 1}
	\label{fig:exp:decen:turbines}
\end{figure}

\Cref{fig:exp:decen:turbines} shows how the regulation cycle time of the decentralized solution changes according to the number of turbines.

It is seen the system performs with a constant regulation cycle time with 5 to 90 turbines, if only observing the median.
The quartiles are with the exception of the 5 turbines experiment of almost constant until 65, the same applies to the maximum values.
The extreme regulation cycle time values all  stop close to 150 ms.
At 70 turbines the maximum value sticks out notably it does look like a outlier however checking the raw data, it is not there are logged regulation cycle times for every ms value between it and the median.
It should be noted that all the data with a cycle time above 132~ms are collected from the same test machine.

\begin{figure}[h!]
	\centering
	\input{figures/tikz/results/Test5_decentral_cycle_cache}
	\caption{Decentralized solution variable number of turbines experiment 1}
	\label{fig:exp:decen:turbines_cache}
\end{figure}


\cref{fig:exp:decen:turbines_cache} show the amount of cache reads the simulation had during part 2 of the experiment.
The plot almost lines up with a exponential curve. Also \cref{fig:exp:decen:turbines,fig:exp:decen:turbines_cache} seams to suddenly increase around 65 ms.

\subsection{Discussion}
\label{sec:disc:turbinesVScycletime}
In the current Siemens system the regulation cycle time of a single Park Pilot scales linearly with the number of turbines.
The aim of the decentralized solution is to detach the regulation cycle time from the number of turbines. 
Looking at \cref{fig:exp:decen:turbines} we see that the decentralized solution seems to be independent of the number of turbines, if the number of turbines is sufficiently low.
From 5 to 65 turbines the regulation cycle time is nearly constant at 20 ms.
The near constant regulation cycle time is caused by the fact that the regulation cycle in the decentralized solution is not forced to wait for data before running the regulation algorithm because data is continually shared between turbines. Adding a turbine to the decentralized solution adds an extra turbine state to factor into the setpoint calculation in the regulation algorithm. This and the added network traffic for the new turbine is the consequence of adding new turbines.

When looking at regulation cycle time of the decentralized solution we must also look at the number of cache reads.
As explained in \cref{sec:exp:performance} a cache read happens when a turbine does not provide a new turbine state package before the next regulation cycle is started.
This forces the regulation cycle to use old data read from cache.
Looking at \cref{fig:exp:decen:turbines_cache} we see that the average number of cache reads in the decentralized solution are below 2 and increasing slightly until we reach 65 turbines. From there the number of cache reads increase exponentially.

The increase in regulation cycle time and cache reads when the number of turbines reaches 65 can be explained by the fact that the network equipment of the test setup is approaching maximum throughput capacity which may cause lost or delayed network packages.
Since regulation cycle time in the decentralized system is dependent on the reception time of the oldest turbine state package as explained in \cref{sec:exp:performance} the loss or delay of network packages has a direct impact on regulation cycle time.
Similarly lost or delayed network packages increases the use of cached data. The increased regulation cycle time and cache reads are thus not a limitation of the decentralized solution but a limitation imposed by the test setup. In order to create a realistic comparison we must disregard the results that are a direct effect of the limitations of our test setup.

Disregarding the limitations imposed by the test setup we see that the regulation cycle time is constant. In terms of regulation cycle time the decentralized solution scales indefinitely. As stated above there is a small increase in regulation cycle time for every turbine added because the state of this turbine has to be taken into consideration when calculating new setpoints on all other turbines. This time addition is not visible on \cref{fig:exp:decen:turbines}. Thus the regulation cycle time will be affected by the addition of turbines but the effect is so small that it is indistinguishable by other factors. Looking at the raw test data 

Still disregarding the limitations imposed by the test setup when looking at the scale factor of the number of cache reads we see another result. The number of cache reads increases slowly with a factor of around 1 cache read for every 30 turbines added, which gives a scale factor of $1 / 30 = 0.033$.

The number of cache reads can be reduced by increasing the regulation cycle time as presented in \cref{fig:exp:decen:sleep-cache}.
Thus the factor deciding the time of the regulation cycle is the maximum number of average cache reads accepted for a single regulation cycle.
